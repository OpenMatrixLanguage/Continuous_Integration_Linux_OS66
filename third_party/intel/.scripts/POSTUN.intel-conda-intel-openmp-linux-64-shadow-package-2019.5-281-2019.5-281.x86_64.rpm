#!/bin/sh
RPM_INSTALL_PREFIX=/users/banspach/oss/third_party/intel
if [ X"$RPM_INSTALL_PREFIX" = X"" ]; then
    RPM_INSTALL_PREFIX=/opt/intel
fi

CONDA_CHANNEL_DIR="${RPM_INSTALL_PREFIX}/conda_channel"
CONDA_INDEX_TOOL="${CONDA_CHANNEL_DIR}/bin/conda-index-tool"

CONDA_PKGS=$(find "${CONDA_CHANNEL_DIR}" -name '*.tar.bz2' -type f 2>/dev/null)

# Remove conda channel if there's no conda packages
if [ ! -z "${CONDA_PKGS}" ]; then 
    if [ -e "${CONDA_INDEX_TOOL}" ] ; then
        "${CONDA_INDEX_TOOL}" "${CONDA_CHANNEL_DIR}"/linux-64 "${CONDA_CHANNEL_DIR}"/linux-32 "${CONDA_CHANNEL_DIR}"/noarch >/dev/null 2>&1
    fi
else
    rm -rf "${CONDA_CHANNEL_DIR}" >/dev/null 2>&1
fi

exit 0